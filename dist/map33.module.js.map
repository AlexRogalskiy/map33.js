{"version":3,"file":"map33.module.js","sources":["../src/material/quadtexture_vert.glsl.js","../src/material/QuadTextureMaterial.js","../src/index.js"],"sourcesContent":["export default `\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n`\n","import {\n  ShaderMaterial,\n  TextureLoader,\n  UniformsLib,\n} from 'three'\nimport vertexShader from './quadtexture_vert.glsl'\nimport fragmentShader from './quadtexture_frag.glsl'\n\nconst loader = new TextureLoader()\n\nconst QuadTextureMaterial = (urls) => {\n  return Promise.all(urls.map(url => loader.loadAsync(url))).then(maps => {\n    return new ShaderMaterial({\n      uniforms: {\n        mapNW: {value: maps[0]},\n        mapSW: {value: maps[1]},\n        mapNE: {value: maps[2]},\n        mapSE: {value: maps[3]},\n        ...UniformsLib.common,\n        ...UniformsLib.lights,\n        ...UniformsLib.fog,\n      },\n      vertexShader,\n      fragmentShader,\n      defines: {\n        USE_MAP: true,\n        USE_UV: true,\n      },\n      lights: true,\n      fog: true,\n    })\n  })\n}\n\nexport default QuadTextureMaterial\n","import getPixels from 'get-pixels'\nimport {\n  PlaneBufferGeometry,\n  Mesh,\n  MeshNormalMaterial,\n  Vector3,\n} from 'three'\nimport QuadTextureMaterial from './material/QuadTextureMaterial'\n\nconst tileMaterial = new MeshNormalMaterial({wireframe: true})\nconst baseTileSize = 600.\n\nclass Utils {\n  static long2tile (lon, zoom) {\n    return (lon + 180) / 360 * Math.pow(2, zoom)\n  }\n\n  static lat2tile (lat, zoom) {\n    return (\n      (1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom)\n      )\n  }\n\n  static geo2tile (geoLocation, zoom) {\n    const maxTile = Math.pow(2, zoom);\n    return {\n      x: Math.abs(Math.floor(Utils.long2tile(geoLocation[1], zoom)) % maxTile),\n      y: Math.abs(Math.floor(Utils.lat2tile(geoLocation[0], zoom)) % maxTile)\n    }\n  }\n\n  static tile2position(z, x, y, center, tileSize) {\n    const offsetAtZ = (z) => {\n      return {\n        x: center.x / Math.pow(2, 10 - z),\n        y: center.y / Math.pow(2, 10 - z),\n      };\n    };\n    const offset = offsetAtZ(z);\n    return {\n      x: (x - center.x - (offset.x % 1) + (center.x % 1)) * tileSize,\n      y: (-y + center.y + (offset.y % 1) - (center.y % 1)) * tileSize,\n      z: 0\n    }\n  }\n\n  static position2tile(z, x, y, center, tileSize) {\n    const centerPosition = Utils.tile2position(z, center.x, center.y, center, tileSize)\n    console.log(centerPosition)\n    const deltaX = Math.round((x - centerPosition.x) / tileSize)\n    const deltaY = Math.round(-(y - centerPosition.y) / tileSize)\n    return {x: deltaX + center.x, y: deltaY + center.y, z}\n  }\n}\n\nclass MapPicker {\n  constructor(camera, map, domElement, controls) {\n    this.vec = new Vector3(); // create once and reuse\n    this.position = new Vector3(); // create once and reuse\n    this.camera = camera\n    this.map = map\n    this.domElement = domElement\n    this.controls = controls\n\n    this.domElement.addEventListener('mousemove', this.onMouseMove.bind(this))\n    this.domElement.addEventListener('dblclick', this.onMouseClick.bind(this))\n  }\n\n  computeWorldPosition(event) {\n    // cf. https://stackoverflow.com/a/13091694/343834\n    this.vec.set(\n      (event.clientX / window.innerWidth) * 2 - 1,\n      -(event.clientY / window.innerHeight) * 2 + 1,\n      0.5);\n\n    this.vec.unproject(this.camera);\n\n    this.vec.sub(this.camera.position).normalize();\n\n    var distance = -this.camera.position.z / this.vec.z;\n\n    this.position.copy(this.camera.position).add(this.vec.multiplyScalar(distance));\n  }\n\n  onMouseMove(event) {\n    // this.computeWorldPosition(event)\n  }\n\n  onMouseClick(event) {\n    this.computeWorldPosition(event)\n    this.map.addFromPosition(this.position.x, this.position.y)\n  }\n\n  go(lat, lon) {\n    this.map.clean()\n    this.map.geoLocation = [lat, lon]\n    this.map.init()\n  }\n}\n\nclass Source {\n  constructor(api, token, options) {\n    this.supportedApis = {\n      'osm': this.mapUrlOSM.bind(this),\n      'mapbox': this.mapUrlMapbox.bind(this),\n      'eox': this.mapUrlSentinel2Cloudless.bind(this),\n      'maptiler': this.mapUrlmapTiler.bind(this),\n    }\n    if (!(api in this.supportedApis)) {\n      throw new Error('Unknown source api');\n    }\n    this.api = api\n    this.token = token\n    this.options = options\n  }\n\n  mapUrlOSM(z, x, y) {\n    return `https://c.tile.openstreetmap.org/${z}/${x}/${y}.png`\n  }\n\n  mapUrlMapbox(z, x, y) {\n    return `https://api.mapbox.com/v4/mapbox.satellite/${z}/${x}/${y}@2x.jpg80?access_token=${this.token}`\n  }\n\n  mapUrlSentinel2Cloudless(z, x, y) {\n    // cf. https://tiles.maps.eox.at/wmts/1.0.0/WMTSCapabilities.xml\n    return `https://tiles.maps.eox.at/wmts?layer=s2cloudless_3857&style=default&tilematrixset=g&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fjpeg&TileMatrix=${z}&TileCol=${x}&TileRow=${y}`\n  }\n\n  mapUrlmapTiler(z, x, y) {\n    return `https://api.maptiler.com/tiles/satellite/${z}/${x}/${y}.jpg?key=${this.token}`\n  }\n\n  mapUrl(z, x, y) {\n    return this.supportedApis[this.api](z, x, y)\n  }\n\n}\n\nclass Tile {\n  constructor(map, z, x, y, size = baseTileSize) {\n    this.map = map\n    this.z = z\n    this.x = x\n    this.y = y\n    this.size = size\n    this.baseURL = \"https://s3.amazonaws.com/elevation-tiles-prod/terrarium\"\n    this.shape = null\n    this.elevation = null\n    this.seamX = false\n    this.seamY = false\n  }\n\n  key() {\n    return `${this.z}/${this.x}/${this.y}`\n  }\n  keyNeighX() {\n    return `${this.z}/${this.x + 1}/${this.y}`\n  }\n  keyNeighY() {\n    return `${this.z}/${this.x}/${this.y + 1}`\n  }\n\n  url() {\n    return `${this.baseURL}/${this.z}/${this.x}/${this.y}.png`\n  }\n\n  mapUrl() {\n    return this.map.source.mapUrl(this.z, this.x, this.y)\n  }\n\n  computeElevation(pixels) {\n    this.shape = pixels.shape\n    const elevation = new Float32Array(pixels.shape[0] * pixels.shape[1])\n    for (let i = 0; i < pixels.shape[0]; i++) {\n      for (let j = 0; j < pixels.shape[1]; j++) {\n        const ij = i + pixels.shape[0] * j\n        const rgba = ij * 4\n        elevation[ij] =\n          pixels.data[rgba] * 256.0 +\n          pixels.data[rgba + 1] +\n          pixels.data[rgba + 2] / 256.0 -\n          32768.0\n      }\n    }\n    this.elevation = elevation\n  }\n\n  buildGeometry() {\n    const geometry = new PlaneBufferGeometry(\n      this.size,\n      this.size,\n      this.shape[0] / 2,\n      this.shape[1] / 2\n    )\n    const nPosition = Math.sqrt(geometry.attributes.position.count)\n    const nElevation = Math.sqrt(this.elevation.length)\n    const ratio = nElevation / (nPosition - 1)\n    let x, y\n    for (\n      // let i = nPosition;\n      let i = 0;\n      i < geometry.attributes.position.count - nPosition;\n      i++\n    ) {\n      // if (i % nPosition === 0 || i % nPosition === nPosition - 1) continue;\n      if (i % nPosition === nPosition - 1) continue\n      x = Math.floor(i / nPosition)\n      y = i % nPosition\n      geometry.attributes.position.setZ(\n        i,\n        this.elevation[\n          Math.round(Math.round(x * ratio) * nElevation + y * ratio)\n        ] * 0.045\n      )\n    }\n    geometry.computeVertexNormals()\n    this.geometry = geometry\n  }\n\n  childrens() {\n    return [\n      new Tile(this.map, this.z + 1, this.x * 2, this.y * 2),\n      new Tile(this.map, this.z + 1, this.x * 2, this.y * 2 + 1),\n      new Tile(this.map, this.z + 1, this.x * 2 + 1, this.y * 2),\n      new Tile(this.map, this.z + 1, this.x * 2 + 1, this.y * 2 + 1),\n    ]\n  }\n\n  buildMaterial() {\n    const urls = this.childrens().map(tile => tile.mapUrl())\n    return QuadTextureMaterial(urls)\n  }\n\n  buildmesh() {\n    this.buildMaterial().then((material) => {\n      this.mesh.material = material\n    })\n    this.mesh = new Mesh(this.geometry, tileMaterial)\n  }\n\n  fetch() {\n    return new Promise((resolve, reject) => {\n      getPixels(this.url(), (err, pixels) => {\n        if (err) console.error(err)\n        this.computeElevation(pixels)\n        this.buildGeometry()\n        this.buildmesh()\n        resolve(this)\n      })\n    })\n  }\n\n  setPosition(center) {\n    const position = Utils.tile2position(\n      this.z,\n      this.x,\n      this.y,\n      center,\n      this.size\n    )\n    this.mesh.position.set(...Object.values(position))\n  }\n\n  resolveSeamY(neighbor) {\n    const tPosition = this.mesh.geometry.attributes.position.count\n    const nPosition = Math.sqrt(tPosition)\n    const nPositionN = Math.sqrt(\n      neighbor.mesh.geometry.attributes.position.count\n    )\n    if (nPosition !== nPositionN) {\n      console.error(\"resolveSeamY only implemented for geometries of same size\")\n      return\n    }\n    for (let i = tPosition - nPosition; i < tPosition; i++) {\n      this.mesh.geometry.attributes.position.setZ(\n        i,\n        neighbor.mesh.geometry.attributes.position.getZ(\n          i - (tPosition - nPosition)\n        )\n      )\n    }\n  }\n\n  resolveSeamX(neighbor) {\n    const tPosition = this.mesh.geometry.attributes.position.count\n    const nPosition = Math.sqrt(tPosition)\n    const nPositionN = Math.sqrt(\n      neighbor.mesh.geometry.attributes.position.count\n    )\n    if (nPosition !== nPositionN) {\n      console.error(\"resolveSeamX only implemented for geometries of same size\")\n      return\n    }\n    for (let i = nPosition - 1; i < tPosition; i += nPosition) {\n      this.mesh.geometry.attributes.position.setZ(\n        i,\n        neighbor.mesh.geometry.attributes.position.getZ(i - nPosition + 1)\n      )\n    }\n  }\n\n  resolveSeams(cache) {\n    let worked = false\n    const neighY = cache[this.keyNeighY()]\n    const neighX = cache[this.keyNeighX()]\n    if (this.seamY === false && neighY && neighY.mesh) {\n      this.resolveSeamY(neighY)\n      this.seamY = true\n      worked = true\n    }\n    if (this.seamX === false && neighX && neighX.mesh) {\n      this.resolveSeamX(neighX)\n      this.seamX = true\n      worked = true\n    }\n    if (worked) {\n      this.mesh.geometry.attributes.position.needsUpdate = true\n      this.mesh.geometry.computeVertexNormals()\n    }\n  }\n}\n\nclass Map {\n  constructor (scene, camera, source, geoLocation, nTiles, zoom=10, options) {\n    this.scene = scene\n    this.camera = camera\n    this.source = source\n    this.geoLocation = geoLocation\n    this.nTiles = nTiles\n    this.zoom = zoom\n    this.options = options\n    this.tileSize = baseTileSize\n\n    this.tileCache = {};\n\n    this.init()\n  }\n\n  init() {\n    this.center = Utils.geo2tile(this.geoLocation, this.zoom)\n    console.log({loc: this.geoLocation, center: this.center})\n    const tileOffset = Math.floor(this.nTiles / 2)\n\n    for (let i = 0; i < this.nTiles; i++) {\n      for (let j = 0; j < this.nTiles; j++) {\n        const tile = new Tile(this, this.zoom, this.center.x + i - tileOffset, this.center.y + j - tileOffset)\n        this.tileCache[tile.key()] = tile\n      }\n    }\n\n    const promises = Object.values(this.tileCache).map(tile =>\n      tile.fetch().then(tile => {\n        tile.setPosition(this.center)\n        this.scene.add(tile.mesh)\n        return tile\n      })\n    )\n\n    Promise.all(promises).then(tiles => {\n      tiles.reverse().forEach(tile => {  // reverse to avoid seams artifacts\n        tile.resolveSeams(this.tileCache)\n      })\n    })\n\n  }\n\n  addFromPosition(posX, posY) {\n    const {\n      x,\n      y,\n      z\n    } = Utils.position2tile(this.zoom, posX, posY, this.center, this.tileSize)\n    console.log({x, y, z})\n    const tile = new Tile(this, this.zoom, x, y)\n\n    if (tile.key() in this.tileCache) return\n\n    this.tileCache[tile.key()] = tile\n    tile.fetch().then(tile => {\n      tile.setPosition(this.center)\n      this.scene.add(tile.mesh)\n    }).then(() => {\n      Object.values(this.tileCache).forEach(tile => tile.resolveSeams(this.tileCache))\n    })\n  }\n\n  clean() {\n    Object.values(this.tileCache).forEach(tile => {\n      this.scene.remove(tile.mesh)\n      tile.mesh.geometry.dispose();\n      ['mapSW', 'mapNW', 'mapSE', 'mapNE'].forEach(key => tile.mesh.material.uniforms[key].value.dispose())\n      tile.mesh.material.dispose()\n    })\n    this.tileCache = {}\n  }\n}\n\nexport {Map, Source, MapPicker}\n"],"names":["loader","TextureLoader","tileMaterial","MeshNormalMaterial","wireframe","Utils","long2tile","lon","zoom","Math","pow","lat2tile","lat","log","tan","PI","cos","geo2tile","geoLocation","maxTile","x","abs","floor","y","tile2position","z","center","tileSize","offset","offsetAtZ","position2tile","centerPosition","console","deltaX","round","deltaY","MapPicker","camera","map","domElement","controls","this","vec","Vector3","position","addEventListener","onMouseMove","bind","onMouseClick","computeWorldPosition","event","set","clientX","window","innerWidth","clientY","innerHeight","unproject","sub","normalize","distance","copy","add","multiplyScalar","addFromPosition","go","clean","init","Source","api","token","options","supportedApis","osm","mapUrlOSM","mapbox","mapUrlMapbox","eox","mapUrlSentinel2Cloudless","maptiler","mapUrlmapTiler","Error","mapUrl","Tile","size","baseURL","shape","elevation","seamX","seamY","key","keyNeighX","keyNeighY","url","source","computeElevation","pixels","Float32Array","i","j","ij","rgba","data","buildGeometry","geometry","PlaneBufferGeometry","nPosition","sqrt","attributes","count","nElevation","length","ratio","setZ","computeVertexNormals","childrens","buildMaterial","urls","tile","Promise","all","loadAsync","then","maps","ShaderMaterial","uniforms","mapNW","value","mapSW","mapNE","mapSE","UniformsLib","common","lights","fog","vertexShader","fragmentShader","defines","USE_MAP","USE_UV","buildmesh","material","_this","mesh","Mesh","fetch","resolve","reject","getPixels","_this2","err","error","setPosition","Object","values","resolveSeamY","neighbor","tPosition","getZ","resolveSeamX","resolveSeams","cache","worked","neighY","neighX","needsUpdate","Map","scene","nTiles","tileCache","loc","tileOffset","promises","_this3","tiles","reverse","forEach","posX","posY","_this4","_this5","remove","dispose"],"mappings":"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"}