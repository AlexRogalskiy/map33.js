{"version":3,"file":"map33.js","sources":["../src/material/quadtexture_vert.glsl.js","../src/material/QuadTextureMaterial.js","../src/index.js"],"sourcesContent":["export default `\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n`\n","import {\n  ShaderMaterial,\n  TextureLoader,\n  UniformsLib,\n} from 'three'\nimport vertexShader from './quadtexture_vert.glsl'\nimport fragmentShader from './quadtexture_frag.glsl'\n\nconst loader = new TextureLoader()\n\nconst QuadTextureMaterial = (urls) => {\n  return Promise.all(urls.map(url => loader.loadAsync(url))).then(maps => {\n    return new ShaderMaterial({\n      uniforms: {\n        mapNW: {value: maps[0]},\n        mapSW: {value: maps[1]},\n        mapNE: {value: maps[2]},\n        mapSE: {value: maps[3]},\n        ...UniformsLib.common,\n        ...UniformsLib.lights,\n        ...UniformsLib.fog,\n      },\n      vertexShader,\n      fragmentShader,\n      defines: {\n        USE_MAP: true,\n        USE_UV: true,\n      },\n      lights: true,\n      fog: true,\n    })\n  })\n}\n\nexport default QuadTextureMaterial\n","import getPixels from 'get-pixels'\nimport {\n  PlaneBufferGeometry,\n  Mesh,\n  MeshNormalMaterial,\n  Vector3,\n} from 'three'\nimport QuadTextureMaterial from './material/QuadTextureMaterial'\n\nconst tileMaterial = new MeshNormalMaterial({wireframe: true})\nconst baseTileSize = 600.\n\nclass Utils {\n  static long2tile (lon, zoom) {\n    return (lon + 180) / 360 * Math.pow(2, zoom)\n  }\n\n  static lat2tile (lat, zoom) {\n    return (\n      (1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom)\n      )\n  }\n\n  static geo2tile (geoLocation, zoom) {\n    const maxTile = Math.pow(2, zoom);\n    return {\n      x: Math.abs(Math.floor(Utils.long2tile(geoLocation[1], zoom)) % maxTile),\n      y: Math.abs(Math.floor(Utils.lat2tile(geoLocation[0], zoom)) % maxTile)\n    }\n  }\n\n  static tile2position(z, x, y, center, tileSize) {\n    const offsetAtZ = (z) => {\n      return {\n        x: center.x / Math.pow(2, 10 - z),\n        y: center.y / Math.pow(2, 10 - z),\n      };\n    };\n    const offset = offsetAtZ(z);\n    return {\n      x: (x - center.x - (offset.x % 1) + (center.x % 1)) * tileSize,\n      y: (-y + center.y + (offset.y % 1) - (center.y % 1)) * tileSize,\n      z: 0\n    }\n  }\n\n  static position2tile(z, x, y, center, tileSize) {\n    const centerPosition = Utils.tile2position(z, center.x, center.y, center, tileSize)\n    console.log(centerPosition)\n    const deltaX = Math.round((x - centerPosition.x) / tileSize)\n    const deltaY = Math.round(-(y - centerPosition.y) / tileSize)\n    return {x: deltaX + center.x, y: deltaY + center.y, z}\n  }\n}\n\nclass MapPicker {\n  constructor(camera, map, domElement) {\n    this.vec = new Vector3(); // create once and reuse\n    this.position = new Vector3(); // create once and reuse\n    this.camera = camera\n    this.map = map\n    this.domElement = domElement\n\n    this.domElement.addEventListener('mousemove', this.onMouseMove.bind(this))\n    this.domElement.addEventListener('dblclick', this.onMouseClick.bind(this))\n  }\n\n  computeWorldPosition(event) {\n    // cf. https://stackoverflow.com/a/13091694/343834\n    this.vec.set(\n      (event.clientX / window.innerWidth) * 2 - 1,\n      -(event.clientY / window.innerHeight) * 2 + 1,\n      0.5);\n\n    this.vec.unproject(this.camera);\n\n    this.vec.sub(this.camera.position).normalize();\n\n    var distance = -this.camera.position.z / this.vec.z;\n\n    this.position.copy(this.camera.position).add(this.vec.multiplyScalar(distance));\n  }\n\n  onMouseMove(event) {\n    // this.computeWorldPosition(event)\n  }\n\n  onMouseClick(event) {\n    this.computeWorldPosition(event)\n    this.map.addFromPosition(this.position.x, this.position.y)\n  }\n\n  go(lat, lon) {\n    this.map.clean()\n    this.map.geoLocation = [lat, lon]\n    this.map.init()\n  }\n}\n\nclass Tile {\n  constructor(z, x, y, size = baseTileSize) {\n    this.size = size\n    this.z = z\n    this.x = x\n    this.y = y\n    this.baseURL = \"https://s3.amazonaws.com/elevation-tiles-prod/terrarium\"\n    this.shape = null\n    this.elevation = null\n    this.seamX = false\n    this.seamY = false\n    this.mapboxToken =\n      \"pk.eyJ1IjoibWF4bXJlIiwiYSI6ImNrY2F5bHk1czBkdXUydHVuNTJoNmxkczEifQ.tzMKMH4ElqyY-xR77zRz_w\"\n  }\n\n  key() {\n    return `${this.z}/${this.x}/${this.y}`\n  }\n  keyNeighX() {\n    return `${this.z}/${this.x + 1}/${this.y}`\n  }\n  keyNeighY() {\n    return `${this.z}/${this.x}/${this.y + 1}`\n  }\n\n  url() {\n    return `${this.baseURL}/${this.z}/${this.x}/${this.y}.png`\n  }\n\n  mapUrlOSM() {\n    return `https://c.tile.openstreetmap.org/${this.z}/${this.x}/${this.y}.png`\n  }\n\n  _mapUrlMapbox(z, x, y, mapboxToken) {\n    return `https://api.mapbox.com/v4/mapbox.satellite/${z}/${x}/${y}@2x.jpg80?access_token=${mapboxToken}`\n  }\n\n  mapUrlMapbox() {\n    return this._mapUrlMapbox(this.z, this.x, this.y, this.mapboxToken)\n  }\n\n  computeElevation(pixels) {\n    this.shape = pixels.shape\n    const elevation = new Float32Array(pixels.shape[0] * pixels.shape[1])\n    for (let i = 0; i < pixels.shape[0]; i++) {\n      for (let j = 0; j < pixels.shape[1]; j++) {\n        const ij = i + pixels.shape[0] * j\n        const rgba = ij * 4\n        elevation[ij] =\n          pixels.data[rgba] * 256.0 +\n          pixels.data[rgba + 1] +\n          pixels.data[rgba + 2] / 256.0 -\n          32768.0\n      }\n    }\n    this.elevation = elevation\n  }\n\n  buildGeometry() {\n    const geometry = new PlaneBufferGeometry(\n      this.size,\n      this.size,\n      this.shape[0] / 2,\n      this.shape[1] / 2\n    )\n    const nPosition = Math.sqrt(geometry.attributes.position.count)\n    const nElevation = Math.sqrt(this.elevation.length)\n    const ratio = nElevation / (nPosition - 1)\n    let x, y\n    for (\n      // let i = nPosition;\n      let i = 0;\n      i < geometry.attributes.position.count - nPosition;\n      i++\n    ) {\n      // if (i % nPosition === 0 || i % nPosition === nPosition - 1) continue;\n      if (i % nPosition === nPosition - 1) continue\n      x = Math.floor(i / nPosition)\n      y = i % nPosition\n      geometry.attributes.position.setZ(\n        i,\n        this.elevation[\n          Math.round(Math.round(x * ratio) * nElevation + y * ratio)\n        ] * 0.045\n      )\n    }\n    geometry.computeVertexNormals()\n    this.geometry = geometry\n  }\n\n  childrens() {\n    return [\n      new Tile(this.z + 1, this.x * 2, this.y * 2),\n      new Tile(this.z + 1, this.x * 2, this.y * 2 + 1),\n      new Tile(this.z + 1, this.x * 2 + 1, this.y * 2),\n      new Tile(this.z + 1, this.x * 2 + 1, this.y * 2 + 1),\n    ]\n  }\n\n  buildMaterial() {\n    const urls = this.childrens().map(tile => tile.mapUrlMapbox())\n    return QuadTextureMaterial(urls)\n  }\n\n  buildmesh() {\n    this.buildMaterial().then((material) => {\n      this.mesh.material = material\n    })\n    this.mesh = new Mesh(this.geometry, tileMaterial)\n  }\n\n  fetch() {\n    return new Promise((resolve, reject) => {\n      getPixels(this.url(), (err, pixels) => {\n        if (err) console.error(err)\n        this.computeElevation(pixels)\n        this.buildGeometry()\n        this.buildmesh()\n        resolve(this)\n      })\n    })\n  }\n\n  setPosition(center) {\n    const position = Utils.tile2position(\n      this.z,\n      this.x,\n      this.y,\n      center,\n      this.size\n    )\n    this.mesh.position.set(...Object.values(position))\n  }\n\n  resolveSeamY(neighbor) {\n    const tPosition = this.mesh.geometry.attributes.position.count\n    const nPosition = Math.sqrt(tPosition)\n    const nPositionN = Math.sqrt(\n      neighbor.mesh.geometry.attributes.position.count\n    )\n    if (nPosition !== nPositionN) {\n      console.error(\"resolveSeamY only implemented for geometries of same size\")\n      return\n    }\n    for (let i = tPosition - nPosition; i < tPosition; i++) {\n      this.mesh.geometry.attributes.position.setZ(\n        i,\n        neighbor.mesh.geometry.attributes.position.getZ(\n          i - (tPosition - nPosition)\n        )\n      )\n    }\n  }\n\n  resolveSeamX(neighbor) {\n    const tPosition = this.mesh.geometry.attributes.position.count\n    const nPosition = Math.sqrt(tPosition)\n    const nPositionN = Math.sqrt(\n      neighbor.mesh.geometry.attributes.position.count\n    )\n    if (nPosition !== nPositionN) {\n      console.error(\"resolveSeamX only implemented for geometries of same size\")\n      return\n    }\n    for (let i = nPosition - 1; i < tPosition; i += nPosition) {\n      this.mesh.geometry.attributes.position.setZ(\n        i,\n        neighbor.mesh.geometry.attributes.position.getZ(i - nPosition + 1)\n      )\n    }\n  }\n\n  resolveSeams(cache) {\n    let worked = false\n    const neighY = cache[this.keyNeighY()]\n    const neighX = cache[this.keyNeighX()]\n    if (this.seamY === false && neighY && neighY.mesh) {\n      this.resolveSeamY(neighY)\n      this.seamY = true\n      worked = true\n    }\n    if (this.seamX === false && neighX && neighX.mesh) {\n      this.resolveSeamX(neighX)\n      this.seamX = true\n      worked = true\n    }\n    if (worked) {\n      this.mesh.geometry.attributes.position.needsUpdate = true\n      this.mesh.geometry.computeVertexNormals()\n    }\n  }\n}\n\nclass Map {\n  constructor (scene, camera, controls, geoLocation, nTiles, zoom=10, options) {\n    this.scene = scene\n    this.camera = camera\n    this.controls = controls\n    this.geoLocation = geoLocation\n    this.nTiles = nTiles\n    this.zoom = zoom\n    this.options = options\n    this.tileSize = baseTileSize\n\n    this.tileCache = {};\n\n    this.init()\n  }\n\n  init() {\n    this.center = Utils.geo2tile(this.geoLocation, this.zoom)\n    console.log({loc: this.geoLocation, center: this.center})\n    const tileOffset = Math.floor(this.nTiles / 2)\n\n    for (let i = 0; i < this.nTiles; i++) {\n      for (let j = 0; j < this.nTiles; j++) {\n        const tile = new Tile(this.zoom, this.center.x + i - tileOffset, this.center.y + j - tileOffset)\n        this.tileCache[tile.key()] = tile\n      }\n    }\n\n    const promises = Object.values(this.tileCache).map(tile =>\n      tile.fetch().then(tile => {\n        tile.setPosition(this.center)\n        this.scene.add(tile.mesh)\n        return tile\n      })\n    )\n\n    Promise.all(promises).then(tiles => {\n      tiles.reverse().forEach(tile => {  // reverse to avoid seams artifacts\n        tile.resolveSeams(this.tileCache)\n      })\n    })\n\n  }\n\n  addFromPosition(posX, posY) {\n    const {\n      x,\n      y,\n      z\n    } = Utils.position2tile(this.zoom, posX, posY, this.center, this.tileSize)\n    console.log({x, y, z})\n    const tile = new Tile(this.zoom, x, y)\n\n    if (tile.key() in this.tileCache) return\n\n    this.tileCache[tile.key()] = tile\n    tile.fetch().then(tile => {\n      tile.setPosition(this.center)\n      this.scene.add(tile.mesh)\n    }).then(() => {\n      Object.values(this.tileCache).forEach(tile => tile.resolveSeams(this.tileCache))\n    })\n  }\n\n  clean() {\n    Object.values(this.tileCache).forEach(tile => {\n      this.scene.remove(tile.mesh)\n      tile.mesh.geometry.dispose();\n      ['mapSW', 'mapNW', 'mapSE', 'mapNE'].forEach(key => tile.mesh.material.uniforms[key].value.dispose())\n      tile.mesh.material.dispose()\n    })\n    this.tileCache = {}\n  }\n}\n\nexport {Map, MapPicker}\n"],"names":["loader","TextureLoader","tileMaterial","MeshNormalMaterial","wireframe","Utils","long2tile","lon","zoom","Math","pow","lat2tile","lat","log","tan","PI","cos","geo2tile","geoLocation","maxTile","x","abs","floor","y","tile2position","z","center","tileSize","offset","offsetAtZ","position2tile","centerPosition","console","deltaX","round","deltaY","MapPicker","camera","map","domElement","this","vec","Vector3","position","addEventListener","onMouseMove","bind","onMouseClick","computeWorldPosition","event","set","clientX","window","innerWidth","clientY","innerHeight","unproject","sub","normalize","distance","copy","add","multiplyScalar","addFromPosition","go","clean","init","Tile","size","baseURL","shape","elevation","seamX","seamY","mapboxToken","key","keyNeighX","keyNeighY","url","mapUrlOSM","_mapUrlMapbox","mapUrlMapbox","computeElevation","pixels","Float32Array","i","j","ij","rgba","data","buildGeometry","geometry","PlaneBufferGeometry","nPosition","sqrt","attributes","count","nElevation","length","ratio","setZ","computeVertexNormals","childrens","buildMaterial","urls","tile","Promise","all","loadAsync","then","maps","ShaderMaterial","uniforms","mapNW","value","mapSW","mapNE","mapSE","UniformsLib","common","lights","fog","vertexShader","fragmentShader","defines","USE_MAP","USE_UV","buildmesh","material","_this","mesh","Mesh","fetch","resolve","reject","getPixels","_this2","err","error","setPosition","Object","values","resolveSeamY","neighbor","tPosition","getZ","resolveSeamX","resolveSeams","cache","worked","neighY","neighX","needsUpdate","scene","controls","nTiles","options","tileCache","loc","tileOffset","promises","_this3","tiles","reverse","forEach","posX","posY","_this4","_this5","remove","dispose"],"mappings":"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"}